## 使用BS模型模拟交易策略
我们使用BS模型预测的期权价格，通过滑动窗口滚动计算其移动平均值、标准差，再使用移动平均值和标准差的数值构建布林带通道，计算公式如下：

![image](https://github.com/kx-c/BSmodel/blob/main/%E6%8D%95%E8%8E%B7.JPG)

布林带通道通过计算移动平均值和标准差来对原始数据进行平滑处理，处理过后的数据相较原始数据走势更平稳，上式中的upper bound又被称为压力线，lower bound又被称为支撑线。通常情况下，在真实的交易情景中，人们往往使用政权历史收盘价数据来构建布林带通道，决策时多采用追涨杀跌的策略，即当证券价格突破压力线时，进行买入操作，跌破支撑线时，执行卖出操作。
此处，我们将滑动窗口大小n设为10天，移动标准差σ的系数a设为0.5，根据上述公式计算出上下均线后与期权真实价格一同作图显示，结果如下：

![image](https://github.com/kx-c/BSmodel/blob/main/MA-1.JPG)

可以看到，由于模型预测价格在低位是表现出对股票价格的低估，因此在进行平滑处理后，构建的布林带通道也处于真实价格的下方。我们利用构建的布林带进行择时交易，得到交易信号量，当执行买入或处于买入状态时操作时，信号量为1，执行卖出操作或处于卖出状态时，信号量为-1，交易信号量变化趋势如下：

![image]()

可以看到，由于模型对期权价格的低估，交易执行并不频繁。此处，我们将手续费设为0.001，和市场平均保持一致，并计算累计收益率。由于策略的指制定需要用到收盘价数据，投资者只能在次日执行买卖操作，故为了防止未来数据干扰实验效果，我们使用历史开盘价计算策略的累计收益率，计算方法为：回报率 = 后日收盘价 / 次日收盘价 - 1，收益率 = 交易信号量 * （回报率 - 手续费） + 1。我们将使用策略和持有的当日收益率作图显示：

![image]()

从图中我们容易看到，基于BS预测定价的布林带策略表现并不够理想，虽然在7月至8月时有过短暂的收益率高峰，但回撤幅度同样较大，行权前夕累计收益率表现有时会出现低于直接持有的现象。出现这种现象的原因可能有：

1）BS模型对期权价格的低估
2）布林带通道的参数设置不当
3）策略本身不适用于该模型预测交易

之后，我们使用多组取值对参数：滑动窗口天数、移动标准差系数α进行调整，得出的结果与前述策略相似，由于真实交易过程中无法获知未来数据，人们通常使用较为常用的参数组合，故很难出现使用极端取值，由结果来拟合提升收益率的现象，故可一定程度上排除参数选取不当的因素。



## 反推隐含波动率构建交易策略

根据之前列出的Black Scholes公式，我们通过使用证券交易价格、行权价格、有效期、无风险利率、年化波动率推算出期权当日的合理价格。计算隐含波动率，即使用期权真实交易价格替代模型预测结果，反推波动率。由于此处波动率的计算没有显式的表达式可以实现，故只能采用迭代调整的方法逼近真实结果，下图为采用二分法计算出的隐含波动率数据和滑动窗口为10天的ETF50收盘价移动标准差的变化趋势。

![image]()

如图，可以看到相较于基金真实价格的波动率，隐含波动率的波动更加明显。

同样对隐含波动率使用布林带择时策略，此处，滑动窗口大小设为20天，σ系数α设为1，通道与原始数据作图显示如下：

![image]()

与前述策略不同的是，波动率的以小为宜，当隐含波动率突破压力线时，即隐含波动率处于高位，执行卖出操作，反之当隐含波动率跌破支撑线时，代表波动率处于低位，执行买入操作，同样计算交易信号，走势如下图：

![image]()

相比于预测价格布林带策略，隐含波动率策略的交易更加频繁，当我们将系数α缩小为0.5时，买卖操作会更加频繁，但对整体的累计收益率影响不大。

仍然使用次日开盘与第三日开盘收益率作为累计收益率计算指标以防止未来数据，最终累计收益率走势如下图：

![image]()

由上图，隐含收益率布林带策略表现并不够理想，整体收益率走势与预测定价策略走势相似，但最高累计收益率更小，回撤较大。我们分析，出现上述结果的原因主要有三：
1）交易策略选取不当
2）策略参数选取不当
3）隐含收益率推算误差较大
其中，交易策略方面，根据现有资料及交易经验，容易发现布林带策略在大多数时候表现较好，并且，在我们对参数进行调整后，整体累计收益表现没有出现显著提升，故我们的注意力主要集中在隐含收益率推算误差方面，我们发现，现有计算工具对隐含收益率的确会有较大的计算误差，具体如下。
如前文所述，我们使用二分法对隐含收益率进行推算，在编写算法中，我们首先采用了0.0001的价格拟合精度对σ进行计算，得到部分数据计算过程中出现0除数现象，程序无法正确执行，经检查发现python运算精度有限，无法实现0.0001的精度模拟，故我们将拟合精度修改为0.001，执行程序后发现与上述问题相同现象。故我们又对迭代次数进行限制，最初我们尝试限制最高迭代次数为10000次，仍然出现上述现象，之后通过多次实验，我们将迭代次数最终限定为1000次，并成功计算出了所有的隐含波动率，前20条隐含波动率如下。

![image]()

可以看到，部分隐含波动率出现相同极小值状况，这些数据即为前述中迭代计算中由于精度原因无法正确计算的数值，我们分析认为，由于Python的计算精度限制，部分波动率在取较小值时无法得到准确结果。
为了提升计算精度，我们同样使用0.0001精度、无迭代次数限制重新对部分隐含收益率进行计算，经过比对，多数计算结果和前述方法计算结果相差为10%~20%。综上所述，我们认为隐含收益率的计算精度对实验有较大影响，主要的技术难点在于，部分数值可以通过多次迭代得到较精确数据，但对于部分数据，由于运算精度限制，多次迭代会导致0除数问题，在统一计算隐含收益率过程中，难以在计算前对数据进行区分，从而实现分类计算，且分类计算工作量较大，手动完成较为吃力。
